<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Skycoders</title>
  <link rel="stylesheet" href="operations.css">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Admin Panel</h2>
      </div>
      <ul class="sidebar-menu">
        <li><a href="../subModules/addFlight.html">Add Flight</a></li>
        <li><a href="../subModules/viewflights.html">View Flights</a></li>
        <li><a href="../subModules/update.html">Update Flight</a></li>
        <li><a href="../subModules/cancel.html">Cancel Flight</a></li>
        <li><a href="#">View Passengers</a></li>
        <li><a href="../subModules/viewbookings.html">View Bookings</a></li>
        <li class="logout"><a href="/Modules/login.html">Logout</a></li>
      </ul>
    </aside>

<!--Main-->
    <div class="main-content">

        <div class="nav">
            <div class="logo">
                <img src="/images/logo.png" alt="Skycoders Logo">
                <span>Skycoders Airline Management System</span>
            </div>
        </div>

          <input type="text" class="srch" placeholder="Search Passengers by name,passport number or flight number">
        
        <div id="passengerContainer" class="passenger-list">

        </div>
        </div>

      <script>

        let passengers =[]; 
        const searchInput = document.querySelector(".srch");

        function handleSearchInput() {
            const query = searchInput.value.trim().toLowerCase();
            if (query === '') {
              renderPassengers(passengers);
            } else {
              const filtered = passengers.filter(p =>
                p.Name.toLowerCase().includes(query) ||
                p.flightNumber.toLowerCase().includes(query) ||
                p.PassportNumber.toLowerCase().includes(query)
              );
              renderPassengers(filtered);
            }
          }

        var Module = {
          onRuntimeInitialized: function() {
            FS.mkdir("/persistent");
            FS.mount(IDBFS, {}, "/persistent");
            FS.syncfs(true, function(e) {
              if(e){
                console.log(`Error Syncing file system: ${e}`);
                return;
              }

              Module.ccall("loadPassengers", null, [], []);

              const ptr = Module.ccall('getAllPassengersJSON', 'number', []);
              const Pjson = Module.UTF8ToString(ptr);
              passengers = JSON.parse(Pjson);
              console.log(passengers);
              
              renderPassengers(passengers);

              searchInput.addEventListener('input', handleSearchInput);

            });
          }
        }


      function renderPassengers(passengers) {
      const container = document.getElementById('passengerContainer');
      container.innerHTML = ''; 

      passengers.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<div class="cardBDrop">
          <h2>${p.Name}</h2>
          <p><span class="label">Passport:</span> ${p.PassportNumber}</p>
          <p><span class="label">Nationality:</span> ${p.Nationality}</p>
          <p><span class="label">Contact:</span> ${p.contact}</p>
          <div><p><button class="details"> ${p.flightNumber}</button></p></div>
          </div>
          <button class="ticket"> Generate Ticket </button>

        `;
        container.appendChild(card);
      });

      if (passengers.length === 0) {
              const noResult = document.createElement('div');
              noResult.textContent = 'No Passengers available';
              noResult.classList.add("no-flight-display");
              container.appendChild(noResult);
              return;
            }



    }
      </script>

      <script src="/Modules/interface.js"></script>
      
</body>
</html>